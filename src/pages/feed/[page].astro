---
import { getCollection } from "astro:content";
import Base from "@/layouts/Base.astro";
import Feed from "@/components/Feed.astro";

export async function getStaticPaths() {
    const allPosts = await getCollection("blog");
    const perPage = 5;
    const totalPages = Math.ceil(allPosts.length / perPage);
    return Array.from({ length: totalPages }, (_, i) => ({
        params: { page: String(i + 1) },
    }));
}

const { page } = Astro.params;
const pageNumber = Number(page) || 1;
const perPage = 5;

const allPosts = await getCollection("blog");
allPosts.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const currentPosts = allPosts.slice(
    (pageNumber - 1) * perPage,
    pageNumber * perPage,
);

const processedPosts = currentPosts.map((post) => {
    const len = post.body.split(/\s+/).length;
    const time = Math.floor(len / 130);
    return { ...post, wordCount: len, readingTime: time > 0 ? time : 1 };
});
---

<Base title={`Feed Page ${pageNumber}`}>
    <Feed posts={processedPosts} />
</Base>
